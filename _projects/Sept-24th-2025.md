---
title: "Installing and Configuring Sysmon for Linux with Splunk Forwarding"
author: Mers Waf
tags:
  - dfir
  - labs
  - linux
  - soc
---

This guide provides step-by-step instructions for installing Sysmon on Linux and forwarding logs to a Splunk server.

## Prerequisites

- Ubuntu Linux system
- Access to sudo/root privileges
- Splunk server instance (configured and running)

## Part 1: Installing Sysmon for Linux

### Step 1: Add Microsoft Package Repository

```
# Download Microsoft's package repository configuration
wget -q https://packages.microsoft.com/config/ubuntu/$(lsb_release -rs)/packages-microsoft-prod.deb -O packages-microsoft-prod.deb

# Install the repository configuration
sudo dpkg -i packages-microsoft-prod.deb
```

### Step 2: Update Package List and Install Sysmon

bash

```
# Update package list
sudo apt-get update

# Install Sysmon for Linux
sudo apt-get install sysmonforlinux
```

### Step 3: Verify Installation

```
# Check available options
sysmon -h
```

### Step 4: Download and Apply Configuration

```
# Download the Sysmon configuration file
wget https://raw.githubusercontent.com/microsoft/MSTIC-Sysmon/main/linux/configs/main.xml

# Install Sysmon with the configuration
sudo sysmon -i

# Apply the configuration file
sudo sysmon -c /home/$(whoami)/main.xml
```

## Part 2: Installing Splunk Universal Forwarder

### Step 1: Download Splunk Universal Forwarder

1. Visit [Splunk Universal Forwarder Download Page](https://www.splunk.com/en_us/download/universal-forwarder.html)
2. Download the DEB package for your Ubuntu version

### Step 2: Install the Universal Forwarder

```
# Install the downloaded package (replace with actual filename)
sudo dpkg -i splunkforwarder-10.0.0-e8eb0c4654f8-linux-2.6-amd64.deb
```

### Step 3: Verify Installation

```
# Check if Splunk forwarder is installed
ls /opt/splunkforwarder
```

### Step 4: Start Splunk Forwarder

```
# Navigate to bin directory
cd /opt/splunkforwarder/bin

# Start Splunk and accept license
sudo ./splunk start --accept-license
```

- Create an admin username and password when prompted

## Part 3: Configure Splunk Server (on your Splunk instance)

### Step 1: Configure Receiving Settings

1. Log into your Splunk web interface
2. Navigate to **Settings > Forwarding and Receiving**
3. Under **Receiving** section, click **Configure Receiving**
4. Click **New Receiving Port**
5. Add port **9997** (default) or your preferred port
6. Save the configuration

### Step 2: Create a New Index

1. Go to **Settings > Indexes**
2. Click **New Index**
3. Name: `linux_logs`
4. Configure other settings as needed
5. Save the new index

## Part 4: Configure Forwarding on Linux Client

### Step 1: Add Forward Server

```
# Navigate to Splunk bin directory
cd /opt/splunkforwarder/bin

# Add your Splunk server as forward target (replace with actual IP)
sudo ./splunk add forward-server <SPLUNK_SERVER_IP>:9997
```

### Step 2: Configure Log Monitoring

```
# Add syslog monitoring with the linux_logs index
sudo ./splunk add monitor /var/log/syslog -index linux_logs
```

### Step 3: Configure Inputs (Alternative Method)

Edit the inputs.conf file for more granular control:

```
# Edit inputs.conf
sudo nano /opt/splunkforwarder/etc/system/local/inputs.conf
```

Add the following configuration:

```
[monitor:///var/log/syslog]
disabled = false
index = linux_logs
sourcetype = syslog
```

### Step 4: Restart Splunk Forwarder

```
# Restart to apply changes
sudo ./splunk restart
```

## Part 5: Testing the Configuration

### Step 1: Generate Test Log Entry

```
# Navigate to Splunk bin directory
cd /opt/splunkforwarder/bin

# Create a test log entry
logger "this is a test message from Sysmon lab"
```

### Step 2: Verify in Splunk

1. Log into your Splunk server
2. Open the Search app
3. Run the following search query:

```
index=linux_logs "this is a test"
```

1. You should see your test message in the results

## Troubleshooting Tips

### Check Sysmon Status

```
# Verify Sysmon is running
sudo systemctl status sysmon
```

### Check Splunk Forwarder Status

```
# Check if Splunk forwarder is running
sudo ./splunk status
```

### Verify Forwarder Connection

```
# List configured forward servers
sudo ./splunk list forward-server
```

### Check Log Files

```
# Monitor Sysmon logs
sudo tail -f /var/log/syslog | grep sysmon

# Check Splunk forwarder logs
tail -f /opt/splunkforwarder/var/log/splunk/splunkd.log
```

## Important Notes

- Replace `<SPLUNK_SERVER_IP>` with your actual Splunk server IP address
- Ensure firewall rules allow communication on port 9997 (or your chosen port)
